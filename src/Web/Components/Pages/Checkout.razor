@page "/checkout"
@using Web.Service
@using Web.Components.Components.Checkout
@inject ShoppingCartService ShoppingCartService
@inject NavigationManager Navigation

@if (pageLoaded)
{
	<div class="container mt-5">
		<h1 class="mb-4">Warenkorb</h1>

		<div class="my-5">
			<NavLink href="/products" class="continue-shopping">

				<span style="margin-bottom: .33rem;">
					<svg width="40" height="21" xmlns="http://www.w3.org/2000/svg" viewBox="-0.5 -0.5 61 21">
						<g>
							<path d="M 50 10 L 25.71 10" fill="none" stroke="rgb(0, 0, 0)" stroke-width="6"
								  stroke-miterlimit="10" pointer-events="stroke" />
							<path d="M 16.71 10 L 28.71 4 L 25.71 10 L 28.71 16 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)"
								  stroke-width="6" stroke-miterlimit="10" pointer-events="all" />
						</g>
					</svg>
				</span>

				Weiter stöbern
			</NavLink>
		</div>

		@foreach (var item in products)
		{
			<ProductCard Product="item" />
		}

		<div class="divider-strong" style="margin: 2rem 0;"></div>

		<div class="apply-discount">
			<input type="text" placeholder="Rabatt-Code">
			<button class="btn btn-primary">Anwenden</button>
		</div>

		<div style="margin: 1rem 0;">
			<div class="subtotal">
				<p>Zwischensumme: @total CHF</p>
			</div>

			<div class="discount text-muted">
				<p>Rabatt: 5 CHF</p>
			</div>
		</div>

		<div class="divider-strong"></div>

		<div class="total">
			<p>Gesamt: @CalulateDiscount() CHF</p>
		</div>

		<button @onclick=NavigateToPay class="btn btn-success px-5 py-2" style="display: flex; margin-left: auto;">Bezahlen</button>
	</div>
}
else
{
	<LoadingSkeleton />
}


@code {
	bool pageLoaded = false;
	private List<Product> products => ShoppingCartService.Products;
	private int total => ShoppingCartService.Total;
	private int discount = 5;

	private void NavigateToPay()
	{
		Navigation.NavigateTo("/pay");
	}

	private int CalulateDiscount()
	{
		var result = total - discount;
		return result < 0 ? 0 : result;
	}

	protected override async Task OnInitializedAsync()
	{
		pageLoaded = true;
	}
}
